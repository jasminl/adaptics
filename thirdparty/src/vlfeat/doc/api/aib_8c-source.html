<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">   
 <meta>
  <!-- Stylesheets -->
  <link href="../web.css" type="text/css" rel="stylesheet"></link>
  <title>VLFeat - C API</title>
  
  
  <!-- Scripts-->
 
 </meta>
 
 <!-- Body Start -->
 <body>
  <div id="header">
   <!-- Google CSE Search Box Begins -->
   <form action=" http://www.vlfeat.org/search.html" method="get" id="cse-search-box" enctype="application/x-www-form-urlencoded">
    <div>
     <input type="hidden" name="cx" value="003215582122030917471:oq23albfeam"></input>
     <input type="hidden" name="cof" value="FORID:11"></input>
     <input type="hidden" name="ie" value="UTF-8"></input>
     <input type="text" name="q" size="31"></input>
     <input type="submit" name="sa" value="Search"></input>
    </div>
   </form>
   <script src="http://www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en" xml:space="preserve" type="text/javascript"></script>
   <!-- Google CSE Search Box Ends -->
   <h1>VLFeat.org</h1>
  </div>
  <div id="headbanner">
  C API
  </div>
  <div id="pagebody">
   <div id="sidebar"> <!-- Navigation Start -->
   <ul>
<li><a href="../index.html">Home</a>
</li>
<li><a href="../download.html">Download</a>
</li>
<li><a href="index.html" class='active' >C API</a>
</li>
<li><a href="../mdoc/mdoc.html">Matlab API</a>
</li>
<li><a href="../man/man.html">Man pages</a>
</li>
<li><a href="../overview/tut.html">Tutorials</a>
</li>
</ul>

   </div> <!-- sidebar -->
   <div id="content">
   
   <div class="doxygen">
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>aib.c</h1><a href="aib_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="comment">/* AUTORIGHTS</span>
<a name="l00009"></a>00009 <span class="comment">Copyright 2007 (c) Andrea Vedaldi and Brian Fulkerson</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">This file is part of VLFeat, available in the terms of the GNU</span>
<a name="l00012"></a>00012 <span class="comment">General Public License version 2.</span>
<a name="l00013"></a>00013 <span class="comment">*/</span>
<a name="l00014"></a>00014 
<a name="l00114"></a>00114 <span class="preprocessor">#include "<a class="code" href="aib_8h.html" title="Agglomerative Information Bottleneck (AIB).">aib.h</a>"</span>
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00117"></a>00117 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00118"></a>00118 <span class="preprocessor">#include &lt;float.h&gt;</span> <span class="comment">/* DBL_MAX */</span>
<a name="l00119"></a>00119 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00120"></a>00120 
<a name="l00122"></a>00122 <span class="preprocessor">#define BETA_MAX DBL_MAX</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span>
<a name="l00134"></a><a class="code" href="aib_8c.html#14bc24cb8ad409132d16de6e3f27b002">00134</a> <span class="keywordtype">void</span> <a class="code" href="aib_8c.html#14bc24cb8ad409132d16de6e3f27b002" title="Normalizes an array of probabilities to sum to 1.">vl_aib_normalize_P</a> (<span class="keywordtype">double</span> * P, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> nelem)
<a name="l00135"></a>00135 {
<a name="l00136"></a>00136     <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> i;
<a name="l00137"></a>00137     <span class="keywordtype">double</span> sum = 0;
<a name="l00138"></a>00138     <span class="keywordflow">for</span>(i=0; i&lt;nelem; i++)
<a name="l00139"></a>00139         sum += P[i];
<a name="l00140"></a>00140     <span class="keywordflow">for</span>(i=0; i&lt;nelem; i++)
<a name="l00141"></a>00141         P[i] /= sum;
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00153"></a><a class="code" href="aib_8c.html#f4a8a12f8fa47997c140b43cd993dc30">00153</a> <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> *<a class="code" href="aib_8c.html#f4a8a12f8fa47997c140b43cd993dc30" title="Allocates and creates a list of nodes.">vl_aib_new_nodelist</a> (<a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> nentries)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155     <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> * nodelist = <a class="code" href="generic_8h.html#e28d261fc7cc26f1457b171d842b53ab" title="Call customizable malloc function.">vl_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a>)*nentries);
<a name="l00156"></a>00156     <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> n;
<a name="l00157"></a>00157     <span class="keywordflow">for</span>(n=0; n&lt;nentries; n++)
<a name="l00158"></a>00158         nodelist[n] = n;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <span class="keywordflow">return</span> nodelist;
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00175"></a><a class="code" href="aib_8c.html#9b903a69b8d1167f48cfe1e00a9e1d33">00175</a> <span class="keywordtype">double</span> * <a class="code" href="aib_8c.html#9b903a69b8d1167f48cfe1e00a9e1d33" title="Allocates and creates the marginal distribution Px.">vl_aib_new_Px</a>(<span class="keywordtype">double</span> * Pcx, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> nvalues, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> nlabels)
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177     <span class="keywordtype">double</span> * Px = <a class="code" href="generic_8h.html#e28d261fc7cc26f1457b171d842b53ab" title="Call customizable malloc function.">vl_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*nvalues);
<a name="l00178"></a>00178     <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> r,c;
<a name="l00179"></a>00179     <span class="keywordflow">for</span>(r=0; r&lt;nvalues; r++)
<a name="l00180"></a>00180     {
<a name="l00181"></a>00181         <span class="keywordtype">double</span> sum = 0;
<a name="l00182"></a>00182         <span class="keywordflow">for</span>(c=0; c&lt;nlabels; c++)
<a name="l00183"></a>00183             sum += Pcx[r*nlabels+c];
<a name="l00184"></a>00184         Px[r] = sum;
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186     <span class="keywordflow">return</span> Px;
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00200"></a><a class="code" href="aib_8c.html#171cd4a6e0622a97286a0a2b2130841c">00200</a> <span class="keywordtype">double</span> * <a class="code" href="aib_8c.html#171cd4a6e0622a97286a0a2b2130841c" title="Allocates and creates the marginal distribution Pc.">vl_aib_new_Pc</a>(<span class="keywordtype">double</span> * Pcx, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> nvalues, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> nlabels)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202     <span class="keywordtype">double</span> * Pc = <a class="code" href="generic_8h.html#e28d261fc7cc26f1457b171d842b53ab" title="Call customizable malloc function.">vl_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*nlabels);
<a name="l00203"></a>00203     <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> r, c;
<a name="l00204"></a>00204     <span class="keywordflow">for</span>(c=0; c&lt;nlabels; c++)
<a name="l00205"></a>00205     {
<a name="l00206"></a>00206         <span class="keywordtype">double</span> sum = 0;
<a name="l00207"></a>00207         <span class="keywordflow">for</span>(r=0; r&lt;nvalues; r++)
<a name="l00208"></a>00208             sum += Pcx[r*nlabels+c];
<a name="l00209"></a>00209         Pc[c] = sum;
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211     <span class="keywordflow">return</span> Pc;
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00227"></a>00227 <span class="keywordtype">void</span> <a class="code" href="aib_8c.html#a567101e4f0835b9a73a9b037afa0953" title="Find the two nodes which have minimum beta.">vl_aib_min_beta</a>
<a name="l00228"></a><a class="code" href="aib_8c.html#a567101e4f0835b9a73a9b037afa0953">00228</a> (<a class="code" href="struct__VlAIB.html" title="AIB algorithm data.">VlAIB</a> * aib, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> * besti, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> * bestj, <span class="keywordtype">double</span> * minbeta)
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230     <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> i;
<a name="l00231"></a>00231     *minbeta = aib-&gt;<a class="code" href="struct__VlAIB.html#70b3605ba8827169b90ab381a8cf8109">beta</a>[0];
<a name="l00232"></a>00232     *besti   = 0;
<a name="l00233"></a>00233     *bestj   = aib-&gt;<a class="code" href="struct__VlAIB.html#4e91b088dc86b990ab288ca6a60f0169">bidx</a>[0];
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     <span class="keywordflow">for</span>(i=0; i&lt;aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a>; i++)
<a name="l00236"></a>00236     {
<a name="l00237"></a>00237         <span class="keywordflow">if</span>(aib-&gt;<a class="code" href="struct__VlAIB.html#70b3605ba8827169b90ab381a8cf8109">beta</a>[i] &lt; *minbeta)
<a name="l00238"></a>00238         {
<a name="l00239"></a>00239             *minbeta = aib-&gt;<a class="code" href="struct__VlAIB.html#70b3605ba8827169b90ab381a8cf8109">beta</a>[i];
<a name="l00240"></a>00240             *besti = i;
<a name="l00241"></a>00241             *bestj = aib-&gt;<a class="code" href="struct__VlAIB.html#4e91b088dc86b990ab288ca6a60f0169">bidx</a>[i];
<a name="l00242"></a>00242         }
<a name="l00243"></a>00243     }
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00266"></a>00266 <span class="keywordtype">void</span> 
<a name="l00267"></a><a class="code" href="aib_8c.html#4b04bbe5d45b4a9fd84aecb173fbab93">00267</a> <a class="code" href="aib_8c.html#4b04bbe5d45b4a9fd84aecb173fbab93" title="Merges two nodes i,j in the internal datastructure.">vl_aib_merge_nodes</a> (<a class="code" href="struct__VlAIB.html" title="AIB algorithm data.">VlAIB</a> * aib, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> i, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> j, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> <span class="keyword">new</span>)
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269   <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> last_entry = aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a> - 1 ;
<a name="l00270"></a>00270   <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> c, n ;
<a name="l00271"></a>00271   
<a name="l00272"></a>00272   <span class="comment">/* clear the list of nodes to update */</span>
<a name="l00273"></a>00273   aib-&gt;<a class="code" href="struct__VlAIB.html#d4109a8fef7a2c65d0f44e3be3445383">nwhich</a> = 0;
<a name="l00274"></a>00274   
<a name="l00275"></a>00275   <span class="comment">/* make sure that i is smaller than j */</span>
<a name="l00276"></a>00276   <span class="keywordflow">if</span>(i &gt; j) { <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> tmp = j; j = i; i = tmp; }
<a name="l00277"></a>00277   
<a name="l00278"></a>00278   <span class="comment">/* -----------------------------------------------------------------</span>
<a name="l00279"></a>00279 <span class="comment">   *                    Merge entries i and j, storing the result in i</span>
<a name="l00280"></a>00280 <span class="comment">   * -------------------------------------------------------------- */</span>
<a name="l00281"></a>00281 
<a name="l00282"></a>00282   aib-&gt; Px   [i] += aib-&gt;<a class="code" href="struct__VlAIB.html#d9e572f80ee4f60b1870ee49abceea57">Px</a>[j] ; 
<a name="l00283"></a>00283   aib-&gt; beta [i]  = BETA_MAX ;
<a name="l00284"></a>00284   aib-&gt; nodes[i]  = new ; 
<a name="l00285"></a>00285 
<a name="l00286"></a>00286   <span class="keywordflow">for</span> (c = 0; c &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a>; c++) 
<a name="l00287"></a>00287     aib-&gt; Pcx [i*aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a> + c] += aib-&gt; Pcx [j*aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a> + c] ;
<a name="l00288"></a>00288     
<a name="l00289"></a>00289   <span class="comment">/* -----------------------------------------------------------------</span>
<a name="l00290"></a>00290 <span class="comment">   *                                              Move last entry to j</span>
<a name="l00291"></a>00291 <span class="comment">   * -------------------------------------------------------------- */</span>
<a name="l00292"></a>00292   
<a name="l00293"></a>00293   aib-&gt; Px    [j]  = aib-&gt; Px    [last_entry]; 
<a name="l00294"></a>00294   aib-&gt; beta  [j]  = aib-&gt; beta  [last_entry];
<a name="l00295"></a>00295   aib-&gt; bidx  [j]  = aib-&gt; bidx  [last_entry]; 
<a name="l00296"></a>00296   aib-&gt; nodes [j]  = aib-&gt; nodes [last_entry];
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   for (c = 0 ;  c &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a> ; c++)
<a name="l00299"></a>00299     aib-&gt; Pcx[j*aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a> + c] = aib-&gt; Pcx [last_entry*aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a> + c] ;
<a name="l00300"></a>00300   
<a name="l00301"></a>00301   <span class="comment">/* delete last entry */</span>
<a name="l00302"></a>00302   aib-&gt; nentries -- ;
<a name="l00303"></a>00303   
<a name="l00304"></a>00304   <span class="comment">/* -----------------------------------------------------------------</span>
<a name="l00305"></a>00305 <span class="comment">   *                                        Scan for entries to update</span>
<a name="l00306"></a>00306 <span class="comment">   * -------------------------------------------------------------- */</span>
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   <span class="comment">/*</span>
<a name="l00309"></a>00309 <span class="comment">   * After mergin entries i and j, we need to update all other entries</span>
<a name="l00310"></a>00310 <span class="comment">   * that had one of these two as closest match. We also need to</span>
<a name="l00311"></a>00311 <span class="comment">   * update the renewend entry i. This is added by the loop below</span>
<a name="l00312"></a>00312 <span class="comment">   * since bidx [i] = j exactly because i was merged.</span>
<a name="l00313"></a>00313 <span class="comment">   *</span>
<a name="l00314"></a>00314 <span class="comment">   * Additionaly, since we moved the last entry back to the entry j,</span>
<a name="l00315"></a>00315 <span class="comment">   * we need to adjust the valeus of bidx to reflect this.</span>
<a name="l00316"></a>00316 <span class="comment">   */</span>
<a name="l00317"></a>00317   
<a name="l00318"></a>00318   for (n = 0 ; n &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a>; n++) {
<a name="l00319"></a>00319     <span class="keywordflow">if</span>(aib-&gt;<a class="code" href="struct__VlAIB.html#4e91b088dc86b990ab288ca6a60f0169">bidx</a>[n] == i || aib-&gt;<a class="code" href="struct__VlAIB.html#4e91b088dc86b990ab288ca6a60f0169">bidx</a>[n] == j) {
<a name="l00320"></a>00320         aib-&gt;<a class="code" href="struct__VlAIB.html#4e91b088dc86b990ab288ca6a60f0169">bidx</a>  [n] = 0;
<a name="l00321"></a>00321         aib-&gt;<a class="code" href="struct__VlAIB.html#70b3605ba8827169b90ab381a8cf8109">beta</a>  [n] = BETA_MAX;
<a name="l00322"></a>00322         aib-&gt;<a class="code" href="struct__VlAIB.html#fb26530f18020afc2256299a9a5b7953">which</a> [aib-&gt;<a class="code" href="struct__VlAIB.html#d4109a8fef7a2c65d0f44e3be3445383">nwhich</a>++] = n ;
<a name="l00323"></a>00323       }
<a name="l00324"></a>00324     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(aib-&gt;<a class="code" href="struct__VlAIB.html#4e91b088dc86b990ab288ca6a60f0169">bidx</a>[n] == last_entry) {
<a name="l00325"></a>00325       aib-&gt;<a class="code" href="struct__VlAIB.html#4e91b088dc86b990ab288ca6a60f0169">bidx</a>[n] = j ;
<a name="l00326"></a>00326     }
<a name="l00327"></a>00327   }
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00345"></a>00345 <span class="keywordtype">void</span> 
<a name="l00346"></a><a class="code" href="aib_8c.html#474eae5c9436f86251eea120221e8bd1">00346</a> <a class="code" href="aib_8c.html#474eae5c9436f86251eea120221e8bd1" title="Updates aib-&amp;gt;beta and aib-&amp;gt;bidx according to aib-&amp;gt;which.">vl_aib_update_beta</a> (<a class="code" href="struct__VlAIB.html" title="AIB algorithm data.">VlAIB</a> * aib)
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348 
<a name="l00349"></a>00349 <span class="preprocessor">#define PLOGP(x) ((x)*log((x)))</span>
<a name="l00350"></a>00350 <span class="preprocessor"></span>
<a name="l00351"></a>00351   <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> i;
<a name="l00352"></a>00352   <span class="keywordtype">double</span> * Px  = aib-&gt;<a class="code" href="struct__VlAIB.html#d9e572f80ee4f60b1870ee49abceea57">Px</a>;
<a name="l00353"></a>00353   <span class="keywordtype">double</span> * Pcx = aib-&gt;<a class="code" href="struct__VlAIB.html#bfc0c209c22acdbd1b34a5af91b1cb85">Pcx</a>;
<a name="l00354"></a>00354   <span class="keywordtype">double</span> * tmp = <a class="code" href="generic_8h.html#e28d261fc7cc26f1457b171d842b53ab" title="Call customizable malloc function.">vl_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a>);
<a name="l00355"></a>00355   <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> a, b, c ; 
<a name="l00356"></a>00356   
<a name="l00357"></a>00357   <span class="comment">/* </span>
<a name="l00358"></a>00358 <span class="comment">   * T1 = I(x,c) - I([x]_ij) = A + B - C</span>
<a name="l00359"></a>00359 <span class="comment">   *</span>
<a name="l00360"></a>00360 <span class="comment">   * A  = \sum_c p(xa,c)           \log ( p(xa,c)          /  p(xa)       ) </span>
<a name="l00361"></a>00361 <span class="comment">   * B  = \sum_c p(xb,c)           \log ( p(xb,c)          /  p(xb)       ) </span>
<a name="l00362"></a>00362 <span class="comment">   * C  = \sum_c (p(xa,c)+p(xb,c)) \log ((p(xa,c)+p(xb,c)) / (p(xa)+p(xb)))</span>
<a name="l00363"></a>00363 <span class="comment">   *</span>
<a name="l00364"></a>00364 <span class="comment">   * C  = C1 + C2</span>
<a name="l00365"></a>00365 <span class="comment">   * C1 = \sum_c (p(xa,c)+p(xb,c)) \log (p(xa,c)+p(xb,c))</span>
<a name="l00366"></a>00366 <span class="comment">   * C2 = - (p(xa)+p(xb) \log (p(xa)+p(xb))</span>
<a name="l00367"></a>00367 <span class="comment">   */</span>
<a name="l00368"></a>00368  
<a name="l00369"></a>00369   <span class="comment">/* precalculate A and B */</span>
<a name="l00370"></a>00370   <span class="keywordflow">for</span> (a = 0; a &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a>; a++) {
<a name="l00371"></a>00371     tmp[a] = 0;
<a name="l00372"></a>00372     <span class="keywordflow">for</span> (c = 0; c &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a>; c++) {
<a name="l00373"></a>00373         <span class="keywordtype">double</span> Pac = Pcx [a*aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a> + c] ;       
<a name="l00374"></a>00374         <span class="keywordflow">if</span>(Pac != 0) tmp[a] += Pac * log (Pac / Px[a]) ;
<a name="l00375"></a>00375     }
<a name="l00376"></a>00376   }
<a name="l00377"></a>00377   
<a name="l00378"></a>00378   <span class="comment">/* for each entry listed in which */</span>
<a name="l00379"></a>00379   <span class="keywordflow">for</span> (i = 0 ; i &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#d4109a8fef7a2c65d0f44e3be3445383">nwhich</a>; i++) {    
<a name="l00380"></a>00380     a = aib-&gt;<a class="code" href="struct__VlAIB.html#fb26530f18020afc2256299a9a5b7953">which</a>[i];
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="comment">/* for each other entry */</span>
<a name="l00383"></a>00383     <span class="keywordflow">for</span>(b = 0 ; b &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a> ; b++) {
<a name="l00384"></a>00384       <span class="keywordtype">double</span> T1 = 0 ;
<a name="l00385"></a>00385       
<a name="l00386"></a>00386       <span class="keywordflow">if</span> (a == b || Px [a] == 0 || Px [b] == 0) continue ;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 
<a name="l00389"></a>00389       T1 = PLOGP ((Px[a] + Px[b])) ;                  <span class="comment">/* - C2 */</span>
<a name="l00390"></a>00390       T1 += tmp[a] + tmp[b] ;                         <span class="comment">/* + A + B */</span>
<a name="l00391"></a>00391 
<a name="l00392"></a>00392       <span class="keywordflow">for</span> (c = 0 ; c &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a>; ++ c) {
<a name="l00393"></a>00393         <span class="keywordtype">double</span> Pac = Pcx [a*aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a> + c] ;
<a name="l00394"></a>00394         <span class="keywordtype">double</span> Pbc = Pcx [b*aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a> + c] ;
<a name="l00395"></a>00395         <span class="keywordflow">if</span> (Pac == 0 &amp;&amp; Pbc == 0) <span class="keywordflow">continue</span>;
<a name="l00396"></a>00396         T1 += - PLOGP ((Pac + Pbc)) ;                 <span class="comment">/* - C1 */</span>
<a name="l00397"></a>00397       }
<a name="l00398"></a>00398       
<a name="l00399"></a>00399       <span class="comment">/* </span>
<a name="l00400"></a>00400 <span class="comment">       * Now we have beta(a,b). We check wether this is the best beta</span>
<a name="l00401"></a>00401 <span class="comment">       * for entries a and b.</span>
<a name="l00402"></a>00402 <span class="comment">       */</span>
<a name="l00403"></a>00403       {
<a name="l00404"></a>00404         <span class="keywordtype">double</span> beta = T1 ;
<a name="l00405"></a>00405         
<a name="l00406"></a>00406         <span class="keywordflow">if</span> (beta &lt; aib-&gt;beta[a])
<a name="l00407"></a>00407           {
<a name="l00408"></a>00408             aib-&gt;<a class="code" href="struct__VlAIB.html#70b3605ba8827169b90ab381a8cf8109">beta</a>[a] = beta;
<a name="l00409"></a>00409             aib-&gt;<a class="code" href="struct__VlAIB.html#4e91b088dc86b990ab288ca6a60f0169">bidx</a>[a] = b;
<a name="l00410"></a>00410           }
<a name="l00411"></a>00411         <span class="keywordflow">if</span> (beta &lt; aib-&gt;beta[b])
<a name="l00412"></a>00412           {
<a name="l00413"></a>00413             aib-&gt;<a class="code" href="struct__VlAIB.html#70b3605ba8827169b90ab381a8cf8109">beta</a>[b] = beta;
<a name="l00414"></a>00414             aib-&gt;<a class="code" href="struct__VlAIB.html#4e91b088dc86b990ab288ca6a60f0169">bidx</a>[b] = a;
<a name="l00415"></a>00415           }
<a name="l00416"></a>00416       }
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418   }
<a name="l00419"></a>00419   <a class="code" href="generic_8h.html#bb97ff524f46d6c5ce9ca8af9e792cc3" title="Call customizable free function.">vl_free</a>(tmp);
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00432"></a><a class="code" href="aib_8c.html#531a6f39064384f6728df5a1641d7f54">00432</a> <span class="keywordtype">void</span> <a class="code" href="aib_8c.html#531a6f39064384f6728df5a1641d7f54" title="Calculates the current information and entropy.">vl_aib_calculate_information</a>(<a class="code" href="struct__VlAIB.html" title="AIB algorithm data.">VlAIB</a> * aib, <span class="keywordtype">double</span> * I, <span class="keywordtype">double</span> * H)
<a name="l00433"></a>00433 {
<a name="l00434"></a>00434     <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> r, c;
<a name="l00435"></a>00435     *H = 0;
<a name="l00436"></a>00436     *I = 0;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     <span class="comment">/* </span>
<a name="l00439"></a>00439 <span class="comment">     * H(x)   = - sum_x p(x)    \ log p(x)</span>
<a name="l00440"></a>00440 <span class="comment">     * I(x,c) =   sum_xc p(x,c) \ log (p(x,c) / p(x)p(c))</span>
<a name="l00441"></a>00441 <span class="comment">     */</span>
<a name="l00442"></a>00442     
<a name="l00443"></a>00443     <span class="comment">/* for each entry */</span>
<a name="l00444"></a>00444     <span class="keywordflow">for</span>(r = 0 ; r&lt; aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a> ; r++) {
<a name="l00445"></a>00445       
<a name="l00446"></a>00446       <span class="keywordflow">if</span> (aib-&gt;<a class="code" href="struct__VlAIB.html#d9e572f80ee4f60b1870ee49abceea57">Px</a>[r] == 0) continue ;
<a name="l00447"></a>00447       *H += -log(aib-&gt;<a class="code" href="struct__VlAIB.html#d9e572f80ee4f60b1870ee49abceea57">Px</a>[r]) * aib-&gt;<a class="code" href="struct__VlAIB.html#d9e572f80ee4f60b1870ee49abceea57">Px</a>[r] ;
<a name="l00448"></a>00448       
<a name="l00449"></a>00449       <span class="keywordflow">for</span>(c=0; c&lt;aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a>; c++) {
<a name="l00450"></a>00450         <span class="keywordflow">if</span> (aib-&gt;<a class="code" href="struct__VlAIB.html#bfc0c209c22acdbd1b34a5af91b1cb85">Pcx</a>[r*aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a>+c] == 0) <span class="keywordflow">continue</span>;
<a name="l00451"></a>00451         *I += aib-&gt;<a class="code" href="struct__VlAIB.html#bfc0c209c22acdbd1b34a5af91b1cb85">Pcx</a>[r*aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a>+c] * 
<a name="l00452"></a>00452           log (aib-&gt;<a class="code" href="struct__VlAIB.html#bfc0c209c22acdbd1b34a5af91b1cb85">Pcx</a>[r*aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a>+c] / (aib-&gt;<a class="code" href="struct__VlAIB.html#d9e572f80ee4f60b1870ee49abceea57">Px</a>[r]*aib-&gt;<a class="code" href="struct__VlAIB.html#55615454e6cce01f25cdb53d3fd9c9bc">Pc</a>[c])) ;
<a name="l00453"></a>00453       }
<a name="l00454"></a>00454     }   
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00484"></a><a class="code" href="aib_8h.html#51ae009a477fa6da30193567703dc908">00484</a> <a class="code" href="struct__VlAIB.html" title="AIB algorithm data.">VlAIB</a> * <a class="code" href="aib_8c.html#4bb02325ebe150348976dbb46183f8f3" title="Allocates and initializes the internal data structure.">vl_aib_new</a>(<span class="keywordtype">double</span> * Pcx, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> nvalues, <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> nlabels)
<a name="l00485"></a>00485 {
<a name="l00486"></a>00486     <a class="code" href="struct__VlAIB.html" title="AIB algorithm data.">VlAIB</a> * aib = <a class="code" href="generic_8h.html#e28d261fc7cc26f1457b171d842b53ab" title="Call customizable malloc function.">vl_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="struct__VlAIB.html" title="AIB algorithm data.">VlAIB</a>));
<a name="l00487"></a>00487     <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> i ;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     aib-&gt;<a class="code" href="struct__VlAIB.html#bfc0c209c22acdbd1b34a5af91b1cb85">Pcx</a>   = Pcx ;
<a name="l00490"></a>00490     aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a> = nvalues ;
<a name="l00491"></a>00491     aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a> = nlabels ;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <a class="code" href="aib_8c.html#14bc24cb8ad409132d16de6e3f27b002" title="Normalizes an array of probabilities to sum to 1.">vl_aib_normalize_P</a> (aib-&gt;<a class="code" href="struct__VlAIB.html#bfc0c209c22acdbd1b34a5af91b1cb85">Pcx</a>, aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a> * aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a>) ;
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     aib-&gt;<a class="code" href="struct__VlAIB.html#d9e572f80ee4f60b1870ee49abceea57">Px</a> = <a class="code" href="aib_8c.html#9b903a69b8d1167f48cfe1e00a9e1d33" title="Allocates and creates the marginal distribution Px.">vl_aib_new_Px</a> (aib-&gt;<a class="code" href="struct__VlAIB.html#bfc0c209c22acdbd1b34a5af91b1cb85">Pcx</a>, aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a>, aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a>) ;
<a name="l00496"></a>00496     aib-&gt;<a class="code" href="struct__VlAIB.html#55615454e6cce01f25cdb53d3fd9c9bc">Pc</a> = <a class="code" href="aib_8c.html#171cd4a6e0622a97286a0a2b2130841c" title="Allocates and creates the marginal distribution Pc.">vl_aib_new_Pc</a> (aib-&gt;<a class="code" href="struct__VlAIB.html#bfc0c209c22acdbd1b34a5af91b1cb85">Pcx</a>, aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a>, aib-&gt;<a class="code" href="struct__VlAIB.html#280b8f0cef4b0ebe01238d19c0fc2993">nlabels</a>) ;
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a> = aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a> ;
<a name="l00499"></a>00499     aib-&gt;<a class="code" href="struct__VlAIB.html#73803e0cf9976751c90601176135a5b3">nodes</a>    = <a class="code" href="aib_8c.html#f4a8a12f8fa47997c140b43cd993dc30" title="Allocates and creates a list of nodes.">vl_aib_new_nodelist</a>(aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a>) ;
<a name="l00500"></a>00500     aib-&gt;<a class="code" href="struct__VlAIB.html#70b3605ba8827169b90ab381a8cf8109">beta</a>     = <a class="code" href="generic_8h.html#e28d261fc7cc26f1457b171d842b53ab" title="Call customizable malloc function.">vl_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a>) ;
<a name="l00501"></a>00501     aib-&gt;<a class="code" href="struct__VlAIB.html#4e91b088dc86b990ab288ca6a60f0169">bidx</a>     = <a class="code" href="generic_8h.html#e28d261fc7cc26f1457b171d842b53ab" title="Call customizable malloc function.">vl_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a>)   * aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a>) ;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <span class="keywordflow">for</span>(i = 0 ; i &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#7e310da83a4b13d5b0e4a5f9ff31dbbf">nentries</a> ; i++)
<a name="l00504"></a>00504       aib-&gt;<a class="code" href="struct__VlAIB.html#70b3605ba8827169b90ab381a8cf8109">beta</a> [i] = BETA_MAX ;
<a name="l00505"></a>00505     
<a name="l00506"></a>00506     <span class="comment">/* Initially we must consider all nodes */</span>
<a name="l00507"></a>00507     aib-&gt;<a class="code" href="struct__VlAIB.html#d4109a8fef7a2c65d0f44e3be3445383">nwhich</a> = aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a>;
<a name="l00508"></a>00508     aib-&gt;<a class="code" href="struct__VlAIB.html#fb26530f18020afc2256299a9a5b7953">which</a>  = <a class="code" href="aib_8c.html#f4a8a12f8fa47997c140b43cd993dc30" title="Allocates and creates a list of nodes.">vl_aib_new_nodelist</a> (aib-&gt;<a class="code" href="struct__VlAIB.html#d4109a8fef7a2c65d0f44e3be3445383">nwhich</a>) ;
<a name="l00509"></a>00509     
<a name="l00510"></a>00510     aib-&gt;<a class="code" href="struct__VlAIB.html#f5e9d01a6c18fc15a75f24445c52ad58">parents</a> = <a class="code" href="generic_8h.html#e28d261fc7cc26f1457b171d842b53ab" title="Call customizable malloc function.">vl_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a>)*(aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a>*2-1));
<a name="l00511"></a>00511     <span class="comment">/* Initially, all parents point to a nonexistent node */</span>
<a name="l00512"></a>00512     <span class="keywordflow">for</span> (i = 0 ; i &lt; 2 * aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a> - 1 ; i++)
<a name="l00513"></a>00513       aib-&gt;<a class="code" href="struct__VlAIB.html#f5e9d01a6c18fc15a75f24445c52ad58">parents</a> [i] = 2 * aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a> ; 
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="comment">/* Allocate cost output vector */</span>
<a name="l00516"></a>00516     aib-&gt;<a class="code" href="struct__VlAIB.html#300dfe014834183cc69758251fa224ec">costs</a> = <a class="code" href="generic_8h.html#e28d261fc7cc26f1457b171d842b53ab" title="Call customizable malloc function.">vl_malloc</a> (<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * (aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a> - 1 + 1)) ;
<a name="l00517"></a>00517   
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="keywordflow">return</span> aib ;
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00527"></a>00527 <span class="keywordtype">void</span> 
<a name="l00528"></a><a class="code" href="aib_8h.html#ef5b4ebd2cb6d4102014bf4a9032f678">00528</a> <a class="code" href="aib_8c.html#145bb0e2d8f512613e8fd3fb92fe7ace" title="Deletes AIB data structure.">vl_aib_delete</a> (<a class="code" href="struct__VlAIB.html" title="AIB algorithm data.">VlAIB</a> * aib)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530   <span class="keywordflow">if</span> (aib) {
<a name="l00531"></a>00531     <span class="keywordflow">if</span> (aib-&gt; nodes)   <a class="code" href="generic_8h.html#bb97ff524f46d6c5ce9ca8af9e792cc3" title="Call customizable free function.">vl_free</a> (aib-&gt; nodes);
<a name="l00532"></a>00532     <span class="keywordflow">if</span> (aib-&gt; beta)    <a class="code" href="generic_8h.html#bb97ff524f46d6c5ce9ca8af9e792cc3" title="Call customizable free function.">vl_free</a> (aib-&gt; beta);
<a name="l00533"></a>00533     <span class="keywordflow">if</span> (aib-&gt; bidx)    <a class="code" href="generic_8h.html#bb97ff524f46d6c5ce9ca8af9e792cc3" title="Call customizable free function.">vl_free</a> (aib-&gt; bidx);
<a name="l00534"></a>00534     <span class="keywordflow">if</span> (aib-&gt; which)   <a class="code" href="generic_8h.html#bb97ff524f46d6c5ce9ca8af9e792cc3" title="Call customizable free function.">vl_free</a> (aib-&gt; which);
<a name="l00535"></a>00535     <span class="keywordflow">if</span> (aib-&gt; Px)      <a class="code" href="generic_8h.html#bb97ff524f46d6c5ce9ca8af9e792cc3" title="Call customizable free function.">vl_free</a> (aib-&gt; Px);
<a name="l00536"></a>00536     <span class="keywordflow">if</span> (aib-&gt; Pc)      <a class="code" href="generic_8h.html#bb97ff524f46d6c5ce9ca8af9e792cc3" title="Call customizable free function.">vl_free</a> (aib-&gt; Pc);
<a name="l00537"></a>00537     <span class="keywordflow">if</span> (aib-&gt; parents) <a class="code" href="generic_8h.html#bb97ff524f46d6c5ce9ca8af9e792cc3" title="Call customizable free function.">vl_free</a> (aib-&gt; parents);
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (aib-&gt; costs)   <a class="code" href="generic_8h.html#bb97ff524f46d6c5ce9ca8af9e792cc3" title="Call customizable free function.">vl_free</a> (aib-&gt; costs);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     <a class="code" href="generic_8h.html#bb97ff524f46d6c5ce9ca8af9e792cc3" title="Call customizable free function.">vl_free</a> (aib) ;
<a name="l00541"></a>00541   }
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00581"></a>00581 VL_EXPORT
<a name="l00582"></a><a class="code" href="aib_8h.html#9512d915c4b42026113274dacfab3df2">00582</a> <span class="keywordtype">void</span> <a class="code" href="aib_8c.html#9512d915c4b42026113274dacfab3df2" title="Runs AIB on Pcx.">vl_aib_process</a>(<a class="code" href="struct__VlAIB.html" title="AIB algorithm data.">VlAIB</a> *aib)
<a name="l00583"></a>00583 {
<a name="l00584"></a>00584     <a class="code" href="host_8h.html#5bd6e91d6bfd0be04101fdca94069c92" title="Same as unsigned int.">vl_uint</a> i, besti, bestj, newnode, nodei, nodej;
<a name="l00585"></a>00585     <span class="keywordtype">double</span> I, H;
<a name="l00586"></a>00586     <span class="keywordtype">double</span> minbeta;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588     <span class="comment">/* Calculate initial value of cost function */</span>
<a name="l00589"></a>00589     <a class="code" href="aib_8c.html#531a6f39064384f6728df5a1641d7f54" title="Calculates the current information and entropy.">vl_aib_calculate_information</a> (aib, &amp;I, &amp;H) ;
<a name="l00590"></a>00590     aib-&gt;<a class="code" href="struct__VlAIB.html#300dfe014834183cc69758251fa224ec">costs</a>[0] = I;
<a name="l00591"></a>00591     
<a name="l00592"></a>00592     <span class="comment">/* Initially which = all */</span>
<a name="l00593"></a>00593     
<a name="l00594"></a>00594     <span class="comment">/* For each merge */</span>
<a name="l00595"></a>00595     <span class="keywordflow">for</span>(i = 0 ; i &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a> - 1 ; i++) {
<a name="l00596"></a>00596       
<a name="l00597"></a>00597       <span class="comment">/* update entries in aib-&gt; which */</span>
<a name="l00598"></a>00598       <a class="code" href="aib_8c.html#474eae5c9436f86251eea120221e8bd1" title="Updates aib-&amp;gt;beta and aib-&amp;gt;bidx according to aib-&amp;gt;which.">vl_aib_update_beta</a>(aib);
<a name="l00599"></a>00599       
<a name="l00600"></a>00600       <span class="comment">/* find best pair of nodes to merge */</span>
<a name="l00601"></a>00601       <a class="code" href="aib_8c.html#a567101e4f0835b9a73a9b037afa0953" title="Find the two nodes which have minimum beta.">vl_aib_min_beta</a> (aib, &amp;besti, &amp;bestj, &amp;minbeta);
<a name="l00602"></a>00602 
<a name="l00603"></a>00603       <span class="keywordflow">if</span>(minbeta == BETA_MAX)
<a name="l00604"></a>00604         <span class="comment">/* only null-probability entries remain */</span>
<a name="l00605"></a>00605         <span class="keywordflow">break</span>;
<a name="l00606"></a>00606       
<a name="l00607"></a>00607       <span class="comment">/* Add the parent pointers for the new node */</span>
<a name="l00608"></a>00608       newnode = aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a> + i ;
<a name="l00609"></a>00609       nodei = aib-&gt;<a class="code" href="struct__VlAIB.html#73803e0cf9976751c90601176135a5b3">nodes</a>[besti];
<a name="l00610"></a>00610       nodej = aib-&gt;<a class="code" href="struct__VlAIB.html#73803e0cf9976751c90601176135a5b3">nodes</a>[bestj];
<a name="l00611"></a>00611 
<a name="l00612"></a>00612       aib-&gt;<a class="code" href="struct__VlAIB.html#f5e9d01a6c18fc15a75f24445c52ad58">parents</a> [nodei] = newnode ;
<a name="l00613"></a>00613       aib-&gt;<a class="code" href="struct__VlAIB.html#f5e9d01a6c18fc15a75f24445c52ad58">parents</a> [nodej] = newnode ;
<a name="l00614"></a>00614       aib-&gt;<a class="code" href="struct__VlAIB.html#f5e9d01a6c18fc15a75f24445c52ad58">parents</a> [newnode] = 0 ;
<a name="l00615"></a>00615       
<a name="l00616"></a>00616       <span class="comment">/* Merge the nodes which produced the minimum beta */</span>
<a name="l00617"></a>00617       <a class="code" href="aib_8c.html#4b04bbe5d45b4a9fd84aecb173fbab93" title="Merges two nodes i,j in the internal datastructure.">vl_aib_merge_nodes</a> (aib, besti, bestj, newnode) ;
<a name="l00618"></a>00618       <a class="code" href="aib_8c.html#531a6f39064384f6728df5a1641d7f54" title="Calculates the current information and entropy.">vl_aib_calculate_information</a> (aib, &amp;I, &amp;H) ;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620       aib-&gt;<a class="code" href="struct__VlAIB.html#300dfe014834183cc69758251fa224ec">costs</a>[i+1] = I;
<a name="l00621"></a>00621       
<a name="l00622"></a>00622       <a class="code" href="generic_8h.html#f68d1c6327bf2226b15c84007eab3d94" title="Call user-customizable printf function.">VL_PRINTF</a> (<span class="stringliteral">"aib: (%5d,%5d)=%5d dE: %10.3g I: %6.4g H: %6.4g updt: %5d\n"</span>, 
<a name="l00623"></a>00623                  nodei, 
<a name="l00624"></a>00624                  nodej, 
<a name="l00625"></a>00625                  newnode,                  
<a name="l00626"></a>00626                  minbeta,
<a name="l00627"></a>00627                  I,
<a name="l00628"></a>00628                  H,
<a name="l00629"></a>00629                  aib-&gt;<a class="code" href="struct__VlAIB.html#d4109a8fef7a2c65d0f44e3be3445383">nwhich</a>) ;
<a name="l00630"></a>00630     }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632     <span class="comment">/* fill ignored entries with NaNs */</span>
<a name="l00633"></a>00633     <span class="keywordflow">for</span>(; i &lt; aib-&gt;<a class="code" href="struct__VlAIB.html#42f6fe7a96b7db033f78a5ffc72d717a">nvalues</a> - 1 ; i++)
<a name="l00634"></a>00634         aib-&gt;<a class="code" href="struct__VlAIB.html#300dfe014834183cc69758251fa224ec">costs</a>[i+1] = <a class="code" href="mathop_8h.html#3f9df65fc71880e96e21e93e3abfd99c" title="IEEE double precision NaN (not signaling).">VL_NAN_D</a> ;
<a name="l00635"></a>00635 } 
</pre></div></div>
    <!-- Doc Here -->
   </div>
  
   </div>
   <div class="clear">&nbsp;</div>
  </div> <!-- pagebody -->
  <div id="footer">
   &copy; 2005-09 Andrea Vedaldi and Brian Fulkerson
  </div> <!-- footer -->
  
  <!-- Google Analytics Begins -->
  <script xml:space="preserve" type="text/javascript">
   //<![CDATA[
    var localre = /vlfeat.org/;
    if(document.location.host.search(localre) != -1)
    {
   var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
   document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
   }
   //]]>
  </script>
  <script xml:space="preserve" type="text/javascript">
    //<![CDATA[
    var localre = /vlfeat.org/;
    if(document.location.host.search(localre) != -1)
    {

   try {
   var pageTracker = _gat._getTracker("UA-4936091-2");
   pageTracker._trackPageview();
   } catch(err) {}

   }
   //]]>
  </script>
  <!-- Google Analytics Ends -->
 </body>
</html>

 
